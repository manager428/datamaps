d3.behavior.drag=function(){function n(){this.on("mousedown.drag",r).on("touchstart.drag",r)}function r(){function l(){var e=n.parentNode;return s?d3.touches(e).filter(function(e){return e.identifier===s})[0]:d3.mouse(e)}function c(){if(!n.parentNode)return h();var e=l(),t=e[0]-u[0],i=e[1]-u[1];a|=t|i,u=e,d3_eventCancel(),r({type:"drag",x:e[0]+o[0],y:e[1]+o[1],dx:t,dy:i})}function h(){r({type:"dragend"}),a&&(d3_eventCancel(),d3.event.target===i&&f.on("click.drag",p,!0)),f.on(s?"touchmove.drag-"+s:"mousemove.drag",null).on(s?"touchend.drag-"+s:"mouseup.drag",null)}function p(){d3_eventCancel(),f.on("click.drag",null)}var n=this,r=e.of(n,arguments),i=d3.event.target,s=d3.event.touches&&d3.event.changedTouches[0].identifier,o,u=l(),a=0,f=d3.select(window).on(s?"touchmove.drag-"+s:"mousemove.drag",c).on(s?"touchend.drag-"+s:"mouseup.drag",h,!0);t?(o=t.apply(n,arguments),o=[o.x-u[0],o.y-u[1]]):o=[0,0],s||d3_eventCancel(),r({type:"dragstart"})}var e=d3_eventDispatch(n,"drag","dragstart","dragend"),t=null;return n.origin=function(e){return arguments.length?(t=e,n):t},d3.rebind(n,e,"on")}