function d3_layout_treeSeparation(e,t){return e.parent==t.parent?1:2}function d3_layout_treeLeft(e){var t=e.children;return t&&t.length?t[0]:e._tree.thread}function d3_layout_treeRight(e){var t=e.children,n;return t&&(n=t.length)?t[n-1]:e._tree.thread}function d3_layout_treeSearch(e,t){var n=e.children;if(n&&(i=n.length)){var r,i,s=-1;while(++s<i)t(r=d3_layout_treeSearch(n[s],t),e)>0&&(e=r)}return e}function d3_layout_treeRightmost(e,t){return e.x-t.x}function d3_layout_treeLeftmost(e,t){return t.x-e.x}function d3_layout_treeDeepest(e,t){return e.depth-t.depth}function d3_layout_treeVisitAfter(e,t){function n(e,r){var i=e.children;if(i&&(a=i.length)){var s,o=null,u=-1,a;while(++u<a)s=i[u],n(s,o),o=s}t(e,r)}n(e,null)}function d3_layout_treeShift(e){var t=0,n=0,r=e.children,i=r.length,s;while(--i>=0)s=r[i]._tree,s.prelim+=t,s.mod+=t,t+=s.shift+(n+=s.change)}function d3_layout_treeMove(e,t,n){e=e._tree,t=t._tree;var r=n/(t.number-e.number);e.change+=r,t.change-=r,t.shift+=n,t.prelim+=n,t.mod+=n}function d3_layout_treeAncestor(e,t,n){return e._tree.ancestor.parent==t.parent?e._tree.ancestor:n}d3.layout.tree=function(){function r(r,i){function u(e,n){var r=e.children,i=e._tree;if(r&&(s=r.length)){var s,o=r[0],a,l=o,c,h=-1;while(++h<s)c=r[h],u(c,a),l=f(c,a,l),a=c;d3_layout_treeShift(e);var p=.5*(o._tree.prelim+c._tree.prelim);n?(i.prelim=n._tree.prelim+t(e,n),i.mod=i.prelim-p):i.prelim=p}else n&&(i.prelim=n._tree.prelim+t(e,n))}function a(e,t){e.x=e._tree.prelim+t;var n=e.children;if(n&&(i=n.length)){var r=-1,i;t+=e._tree.mod;while(++r<i)a(n[r],t)}}function f(e,n,r){if(n){var i=e,s=e,o=n,u=e.parent.children[0],a=i._tree.mod,f=s._tree.mod,l=o._tree.mod,c=u._tree.mod,h;while(o=d3_layout_treeRight(o),i=d3_layout_treeLeft(i),o&&i)u=d3_layout_treeLeft(u),s=d3_layout_treeRight(s),s._tree.ancestor=e,h=o._tree.prelim+l-i._tree.prelim-a+t(o,i),h>0&&(d3_layout_treeMove(d3_layout_treeAncestor(o,e,r),e,h),a+=h,f+=h),l+=o._tree.mod,a+=i._tree.mod,c+=u._tree.mod,f+=s._tree.mod;o&&!d3_layout_treeRight(s)&&(s._tree.thread=o,s._tree.mod+=l-f),i&&!d3_layout_treeLeft(u)&&(u._tree.thread=i,u._tree.mod+=a-c,r=e)}return r}var s=e.call(this,r,i),o=s[0];d3_layout_treeVisitAfter(o,function(e,t){e._tree={ancestor:e,prelim:0,mod:0,change:0,shift:0,number:t?t._tree.number+1:0}}),u(o),a(o,-o._tree.prelim);var l=d3_layout_treeSearch(o,d3_layout_treeLeftmost),c=d3_layout_treeSearch(o,d3_layout_treeRightmost),h=d3_layout_treeSearch(o,d3_layout_treeDeepest),p=l.x-t(l,c)/2,d=c.x+t(c,l)/2,v=h.depth||1;return d3_layout_treeVisitAfter(o,function(e){e.x=(e.x-p)/(d-p)*n[0],e.y=e.depth/v*n[1],delete e._tree}),s}var e=d3.layout.hierarchy().sort(null).value(null),t=d3_layout_treeSeparation,n=[1,1];return r.separation=function(e){return arguments.length?(t=e,r):t},r.size=function(e){return arguments.length?(n=e,r):n},d3_layout_hierarchyRebind(r,e)}