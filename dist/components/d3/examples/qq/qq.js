function randomize(e){return e.y=d3.range(n).map(Math.random),e}function qqChart(){function a(a){a.each(function(a,f){var l=d3.select(this),c=qqQuantiles(s,o.call(this,a,f)),h=qqQuantiles(s,u.call(this,a,f)),p=r&&r.call(this,a,f)||[d3.min(c),d3.max(c)],d=r&&r.call(this,a,f)||[d3.min(h),d3.max(h)],v,m,g=d3.scale.linear().domain(p).range([0,e]),b=d3.scale.linear().domain(d).range([t,0]);this.__chart__?(v=this.__chart__.x,m=this.__chart__.y):(v=d3.scale.linear().domain([0,Infinity]).range(g.range()),m=d3.scale.linear().domain([0,Infinity]).range(b.range())),this.__chart__={x:g,y:b};var w=l.selectAll("line.diagonal").data([null]);w.enter().append("svg:line").attr("class","diagonal").attr("x1",g(d[0])).attr("y1",b(p[0])).attr("x2",g(d[1])).attr("y2",b(p[1])),w.transition().duration(n).attr("x1",g(d[0])).attr("y1",b(p[0])).attr("x2",g(d[1])).attr("y2",b(p[1]));var E=l.selectAll("circle").data(d3.range(s).map(function(e){return{x:c[e],y:h[e]}}));E.enter().append("svg:circle").attr("class","quantile").attr("r",4.5).attr("cx",function(e){return v(e.x)}).attr("cy",function(e){return m(e.y)}).style("opacity",1e-6).transition().duration(n).attr("cx",function(e){return g(e.x)}).attr("cy",function(e){return b(e.y)}).style("opacity",1),E.transition().duration(n).attr("cx",function(e){return g(e.x)}).attr("cy",function(e){return b(e.y)}).style("opacity",1),E.exit().transition().duration(n).attr("cx",function(e){return g(e.x)}).attr("cy",function(e){return b(e.y)}).style("opacity",1e-6).remove();var S=i||g.tickFormat(4),T=i||b.tickFormat(4),N=function(e){return"translate("+g(e)+","+t+")"},C=function(e){return"translate(0,"+b(e)+")"},k=l.selectAll("g.x.tick").data(g.ticks(4),function(e){return this.textContent||S(e)}),L=k.enter().append("svg:g").attr("class","x tick").attr("transform",function(e){return"translate("+v(e)+","+t+")"}).style("opacity",1e-6);L.append("svg:line").attr("y1",0).attr("y2",-6),L.append("svg:text").attr("text-anchor","middle").attr("dy","1em").text(S),L.transition().duration(n).attr("transform",N).style("opacity",1),k.transition().duration(n).attr("transform",N).style("opacity",1),k.exit().transition().duration(n).attr("transform",N).style("opacity",1e-6).remove();var A=l.selectAll("g.y.tick").data(b.ticks(4),function(e){return this.textContent||T(e)}),O=A.enter().append("svg:g").attr("class","y tick").attr("transform",function(e){return"translate(0,"+m(e)+")"}).style("opacity",1e-6);O.append("svg:line").attr("x1",0).attr("x2",6),O.append("svg:text").attr("text-anchor","end").attr("dx","-.5em").attr("dy",".3em").text(T),O.transition().duration(n).attr("transform",C).style("opacity",1),A.transition().duration(n).attr("transform",C).style("opacity",1),A.exit().transition().duration(n).attr("transform",C).style("opacity",1e-6).remove()})}var e=1,t=1,n=0,r=null,i=null,s=100,o=qqX,u=qqY;return a.width=function(t){return arguments.length?(e=t,a):e},a.height=function(e){return arguments.length?(t=e,a):t},a.duration=function(e){return arguments.length?(n=e,a):n},a.domain=function(e){return arguments.length?(r=e==null?e:d3.functor(e),a):r},a.count=function(e){return arguments.length?(s=e,a):s},a.x=function(e){return arguments.length?(o=e,a):o},a.y=function(e){return arguments.length?(u=e,a):u},a.tickFormat=function(e){return arguments.length?(i=e,a):i},a}function qqQuantiles(e,t){var n=t.length-1;return t=t.slice().sort(d3.ascending),d3.range(e).map(function(r){return t[~~(r*n/e)]})}function qqX(e){return e.x}function qqY(e){return e.y}var width=280,height=280,margin={top:10,right:10,botom:20,left:35},n=1e4,chart=qqChart().width(width).height(height).domain([-0.1,1.1]).tickFormat(function(e){return~~(e*100)}),vis=d3.select("#chart").append("svg").append("g").attr("transform","translate("+margin.left+","+margin.top+")");d3.json("turkers.json",function(e){var t=science.stats.mean(e),r=Math.sqrt(science.stats.variance(e)),i=[[.10306430789206111,.0036139086950272735,.30498647327844536],[.5924252668569606,.0462763685758622,.4340870312025223],[.9847627827855167,.0002352350767874714,.2609264955190324]],s=vis.selectAll("g").data([{x:d3.range(n).map(Math.random),y:e,label:"Uniform Distribution"},{x:d3.range(n).map(normal1(t,r)),y:e,label:"Gaussian (Normal) Distribution"},{x:d3.range(n).map(normal3(i)),y:e,label:"Mixture of 3 Gaussians"}]).enter().append("g").attr("class","qq").attr("transform",function(e,t){return"translate("+(width+margin.right+margin.left)*t+")"});s.append("rect").attr("class","box").attr("width",width).attr("height",height),s.call(chart),s.append("text").attr("dy","1.3em").attr("dx",".6em").text(function(e){return e.label}),chart.duration(1e3),window.transition=function(){s.datum(randomize).call(chart)}})