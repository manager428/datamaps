function horizonChart(){function c(c){c.each(function(c,h){var p=d3.select(this),d=2*e+1,v=Infinity,m=-Infinity,g=-Infinity,b,w,E,S=c.map(function(e,t){var n=r.call(this,e,t),s=i.call(this,e,t);return n<v&&(v=n),n>m&&(m=n),-s>g&&(g=-s),s>g&&(g=s),[n,s]}),T=d3.scale.linear().domain([v,m]).range([0,s]),N=d3.scale.linear().domain([0,g]).range([0,o*e]);this.__chart__?(b=this.__chart__.x,w=this.__chart__.y,E=this.__chart__.id):(b=d3.scale.linear().domain([0,Infinity]).range(T.range()),w=d3.scale.linear().domain([0,Infinity]).range(N.range()),E=++u);var C=p.selectAll("defs").data([S]),k=C.enter().append("svg:defs");k.append("svg:clipPath").attr("id","horizon_clip"+E).append("svg:rect").attr("width",s).attr("height",o),C.select("rect").transition().duration(f).attr("width",s).attr("height",o),k.append("svg:path").attr("id","horizon_path"+E).attr("d",a.interpolate(n).x(function(e){return b(e[0])}).y0(o*e).y1(function(t){return o*e-w(t[1])})).transition().duration(f).attr("d",a.x(function(e){return T(e[0])}).y1(function(t){return o*e-N(t[1])})),C.select("path").transition().duration(f).attr("d",a),p.selectAll("g").data([null]).enter().append("svg:g").attr("clip-path","url(#horizon_clip"+E+")");var L=t=="offset"?function(t){return"translate(0,"+(t+(t<0)-e)*o+")"}:function(t){return(t<0?"scale(1,-1)":"")+"translate(0,"+(t-e)*o+")"},A=p.select("g").selectAll("use").data(d3.range(-1,-e-1,-1).concat(d3.range(1,e+1)),Number);A.enter().append("svg:use").attr("xlink:href","#horizon_path"+E).attr("transform",function(e){return L(e+(e>0?1:-1))}).style("fill",l).transition().duration(f).attr("transform",L),A.transition().duration(f).attr("transform",L).style("fill",l),A.exit().transition().duration(f).attr("transform",L).remove(),this.__chart__={x:T,y:N,id:E}}),d3.timer.flush()}var e=1,t="offset",n="linear",r=horizonX,i=horizonY,s=960,o=40,u=0,a=d3.svg.area(),f=0,l=d3.scale.linear().domain([-1,0,1]).range(["#d62728","#fff","#1f77b4"]);return c.duration=function(e){return arguments.length?(f=+e,c):f},c.bands=function(t){return arguments.length?(e=+t,l.domain([-e,0,e]),c):e},c.mode=function(e){return arguments.length?(t=e+"",c):t},c.colors=function(e){return arguments.length?(l.range(e),c):l.range()},c.interpolate=function(e){return arguments.length?(n=e+"",c):n},c.x=function(e){return arguments.length?(r=e,c):r},c.y=function(e){return arguments.length?(i=e,c):i},c.width=function(e){return arguments.length?(s=+e,c):s},c.height=function(e){return arguments.length?(o=+e,c):o},c}function horizonX(e){return e[0]}function horizonY(e){return e[1]}var width=960,height=40,chart=horizonChart().width(width).height(height).bands(5).mode("offset").interpolate("basis"),svg=d3.select("#chart").append("svg").attr("width",width).attr("height",height);d3.json("unemployment.json",function(e){var t=e.rate.reduce(function(e,t){return e+t},0)/e.rate.length;e=e.rate.map(function(n,r){return[Date.UTC(e.year[r],e.month[r]-1),n-t]}),svg.data([e]).call(chart),d3.selectAll("#mode button").data(["offset","mirror"]).on("click",function(e){svg.call(chart.duration(0).mode(e)),d3.selectAll("#mode button").classed("active",function(t){return t==e})}),d3.selectAll("#bands button").data([-1,1]).on("click",function(t){svg.call(chart.duration(1e3).bands(Math.max(1,chart.bands()+t)))})})