function update(){vis.select("path").attr("d",line);var e=vis.selectAll("circle").data(points,function(e){return e});e.enter().append("circle").attr("r",1e-6).on("mousedown",function(e){selected=dragged=e,update()}).transition().duration(750).ease("elastic").attr("r",6.5),e.classed("selected",function(e){return e===selected}).attr("cx",function(e){return e[0]}).attr("cy",function(e){return e[1]}),e.exit().remove(),d3.event&&(d3.event.preventDefault(),d3.event.stopPropagation())}function mousemove(){if(!dragged)return;var e=d3.mouse(vis.node());dragged[0]=Math.max(0,Math.min(width,e[0])),dragged[1]=Math.max(0,Math.min(height,e[1])),update()}function mouseup(){if(!dragged)return;mousemove(),dragged=null}function keydown(){if(!selected)return;switch(d3.event.keyCode){case 8:case 46:var e=points.indexOf(selected);points.splice(e,1),selected=points.length?points[e>0?e-1:0]:null,update()}}var width=960,height=500,line=d3.svg.line(),points=d3.range(1,5).map(function(e){return[e*width/5,50+Math.random()*(height-100)]}),dragged=null,selected=points[0],vis=d3.select("#chart").append("svg").attr("width",width).attr("height",height);vis.append("rect").attr("width",width).attr("height",height).on("mousedown",function(){points.push(selected=dragged=d3.mouse(vis.node())),update()}),vis.append("path").data([points]).attr("class","line").call(update),d3.select(window).on("mousemove",mousemove).on("mouseup",mouseup).on("keydown",keydown),d3.select("#interpolate").on("change",function(){line.interpolate(this.value),update()}).selectAll("option").data(["linear","step-before","step-after","basis","basis-open","basis-closed","cardinal","cardinal-open","cardinal-closed","monotone"]).enter().append("option").attr("value",String).text(String)