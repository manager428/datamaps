var boid=function(){function e(){function g(t){var i=y(t);n(e),a[0]+=i[0],a[1]+=i[1];if(f){var s=r(f,e,l);a[0]+=s[0],a[1]+=s[1]}return u(a,h),e[0]+=a[0],e[1]+=a[1],e}function y(n){var r=[0,0],o=[0,0],a=[0,0],f=0,h=0,g=0,y=-1,w=n.length;while(++y<w){var E=n[y];if(E===this)continue;var S=E.position(),x=i(e,S);if(x>0){if(x<m){var T=t(s(e.slice(),S));r[0]+=T[0]/x,r[1]+=T[1]/x,f++}if(x<l){var N=E.velocity();o[0]+=N[0],o[1]+=N[1],h++,a[0]+=S[0],a[1]+=S[1],g++}}}return f>0&&(r[0]/=f,r[1]/=f),h>0&&(o[0]/=h,o[1]/=h),u(o,c),g>0?(a[0]/=g,a[1]/=g):a=e.slice(),a=b(a),[r[0]*p+o[0]*d+a[0]*v,r[1]*p+o[1]*d+a[1]*v]}function b(n){var r=s(n,e),i=o(r);if(i>0){t(r);var f=h*(i<100?i/100:1);r[0]*=f,r[1]*=f;var l=s(r,a);u(l,c)}else l=[0,0];return l}var e=[0,0],a=[0,0],f=null,l=50,c=.1,h=1,p=2,d=1,v=1,m=10;return g.position=function(t){return arguments.length?(e=t,g):e},g.velocity=function(e){return arguments.length?(a=e,g):a},g.gravityCenter=function(e){return arguments.length?(f=e,g):f},g.neighborRadius=function(e){return arguments.length?(l=e,g):l},g.maxForce=function(e){return arguments.length?(c=e,g):c},g.maxSpeed=function(e){return arguments.length?(h=e,g):h},g.separationWeight=function(e){return arguments.length?(p=e,g):p},g.alignmentWeight=function(e){return arguments.length?(d=e,g):d},g.cohesionWeight=function(e){return arguments.length?(v=e,g):v},g.desiredSeparation=function(e){return arguments.length?(m=e,g):m},g}function t(e){var t=o(e);return t>0&&(e[0]/=t,e[1]/=t),e}function n(e){e[0]>width?e[0]=0:e[0]<0&&(e[0]=width),e[1]>height?e[1]=0:e[1]<0&&(e[1]=height)}function r(e,n,r){if(e[0]!=null){var i=s(e.slice(),n),u=o(i)-10;if(u>0&&u<r*5)return t(i),i[0]/=u,i[1]/=u,i}return[0,0]}function i(e,t){var n=e[0]-t[0],r=e[1]-t[1];return n>width/2&&(n=width-n),r>height/2&&(r=height-r),Math.sqrt(n*n+r*r)}function s(e,t){return e[0]-=t[0],e[1]-=t[1],e}function o(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function u(e,n){return o(e)>n&&(t(e),e[0]*=n,e[1]*=n),e}return e}()