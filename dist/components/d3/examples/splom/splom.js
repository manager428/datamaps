d3.json("flowers.json",function(e){function l(r){var o=d3.select(this);o.append("rect").attr("class","frame").attr("x",n/2).attr("y",n/2).attr("width",t-n).attr("height",t-n),o.selectAll("circle").data(e.values).enter().append("circle").attr("class",function(e){return e.species}).attr("cx",function(e){return i[r.x](e[r.x])}).attr("cy",function(e){return s[r.y](e[r.y])}).attr("r",3),o.call(u.x(i[r.x]).y(s[r.y]))}function c(e){u.data!==e&&(f.call(u.clear()),u.x(i[e.x]).y(s[e.y]).data=e)}function u(e){var t=u.extent();a.selectAll("circle").attr("class",function(n){return t[0][0]<=n[e.x]&&n[e.x]<=t[1][0]&&t[0][1]<=n[e.y]&&n[e.y]<=t[1][1]?n.species:null})}function h(){u.empty()&&a.selectAll("circle").attr("class",function(e){return e.species})}function p(e,t){var n=[],r=e.length,i=t.length,s,o;for(s=-1;++s<r;)for(o=-1;++o<i;)n.push({x:e[s],i:s,y:t[o],j:o});return n}var t=150,n=19.5,r=e.traits.length,i={},s={};e.traits.forEach(function(r){var o=function(e){return e[r]},u=[d3.min(e.values,o),d3.max(e.values,o)],a=[n/2,t-n/2];i[r]=d3.scale.linear().domain(u).range(a),s[r]=d3.scale.linear().domain(u).range(a.slice().reverse())});var o=d3.svg.axis().ticks(5).tickSize(t*r),u=d3.svg.brush().on("brushstart",c).on("brush",u).on("brushend",h),a=d3.select("#chart").append("svg").attr("width",t*r+n).attr("height",t*r+n);a.selectAll("g.x.axis").data(e.traits).enter().append("g").attr("class","x axis").attr("transform",function(e,n){return"translate("+n*t+",0)"}).each(function(e){d3.select(this).call(o.scale(i[e]).orient("bottom"))}),a.selectAll("g.y.axis").data(e.traits).enter().append("g").attr("class","y axis").attr("transform",function(e,n){return"translate(0,"+n*t+")"}).each(function(e){d3.select(this).call(o.scale(s[e]).orient("right"))});var f=a.selectAll("g.cell").data(p(e.traits,e.traits)).enter().append("g").attr("class","cell").attr("transform",function(e){return"translate("+e.i*t+","+e.j*t+")"}).each(l);f.filter(function(e){return e.i==e.j}).append("text").attr("x",n).attr("y",n).attr("dy",".71em").text(function(e){return e.x})})