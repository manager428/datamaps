function randomize(e){return e.randomizer||(e.randomizer=randomizer(e)),e.ranges=e.ranges.map(e.randomizer),e.markers=e.markers.map(e.randomizer),e.measures=e.measures.map(e.randomizer),e}function randomizer(e){var t=d3.max(e.ranges)*.2;return function(e){return Math.max(0,e+t*(Math.random()-.5))}}function bulletChart(){function f(e){e.each(function(e,f){var l=r.call(this,e,f).slice().sort(d3.descending),c=i.call(this,e,f).slice().sort(d3.descending),h=s.call(this,e,f).slice().sort(d3.descending),p=d3.select(this),d=d3.scale.linear().domain([0,Math.max(l[0],c[0],h[0])]).range(t?[o,0]:[0,o]),v=this.__chart__||d3.scale.linear().domain([0,Infinity]).range(d.range());this.__chart__=d;var m=bulletWidth(v),g=bulletWidth(d),y=p.selectAll("rect.range").data(l);y.enter().append("svg:rect").attr("class",function(e,t){return"range s"+t}).attr("width",m).attr("height",u).attr("x",t?v:0).transition().duration(n).attr("width",g).attr("x",t?d:0),y.transition().duration(n).attr("x",t?d:0).attr("width",g).attr("height",u);var b=p.selectAll("rect.measure").data(h);b.enter().append("svg:rect").attr("class",function(e,t){return"measure s"+t}).attr("width",m).attr("height",u/3).attr("x",t?v:0).attr("y",u/3).transition().duration(n).attr("width",g).attr("x",t?d:0),b.transition().duration(n).attr("width",g).attr("height",u/3).attr("x",t?d:0).attr("y",u/3);var w=p.selectAll("line.marker").data(c);w.enter().append("svg:line").attr("class","marker").attr("x1",v).attr("x2",v).attr("y1",u/6).attr("y2",u*5/6).transition().duration(n).attr("x1",d).attr("x2",d),w.transition().duration(n).attr("x1",d).attr("x2",d).attr("y1",u/6).attr("y2",u*5/6);var E=a||d.tickFormat(8),S=p.selectAll("g.tick").data(d.ticks(8),function(e){return this.textContent||E(e)}),x=S.enter().append("svg:g").attr("class","tick").attr("transform",bulletTranslate(v)).style("opacity",1e-6);x.append("svg:line").attr("y1",u).attr("y2",u*7/6),x.append("svg:text").attr("text-anchor","middle").attr("dy","1em").attr("y",u*7/6).text(E),x.transition().duration(n).attr("transform",bulletTranslate(d)).style("opacity",1);var T=S.transition().duration(n).attr("transform",bulletTranslate(d)).style("opacity",1);T.select("line").attr("y1",u).attr("y2",u*7/6),T.select("text").attr("y",u*7/6),S.exit().transition().duration(n).attr("transform",bulletTranslate(d)).style("opacity",1e-6).remove()}),d3.timer.flush()}var e="left",t=!1,n=0,r=bulletRanges,i=bulletMarkers,s=bulletMeasures,o=380,u=30,a=null;return f.orient=function(n){return arguments.length?(e=n,t=e=="right"||e=="bottom",f):e},f.ranges=function(e){return arguments.length?(r=e,f):r},f.markers=function(e){return arguments.length?(i=e,f):i},f.measures=function(e){return arguments.length?(s=e,f):s},f.width=function(e){return arguments.length?(o=e,f):o},f.height=function(e){return arguments.length?(u=e,f):u},f.tickFormat=function(e){return arguments.length?(a=e,f):a},f.duration=function(e){return arguments.length?(n=e,f):n},f}function bulletRanges(e){return e.ranges}function bulletMarkers(e){return e.markers}function bulletMeasures(e){return e.measures}function bulletTranslate(e){return function(t){return"translate("+e(t)+",0)"}}function bulletWidth(e){var t=e(0);return function(n){return Math.abs(e(n)-t)}}var width=960,height=50,margin={top:5,right:40,bottom:20,left:120},chart=bulletChart().width(width-margin.right-margin.left).height(height-margin.top-margin.bottom);d3.json("bullets.json",function(e){var t=d3.select("#chart").selectAll("svg").data(e).enter().append("svg").attr("class","bullet").attr("width",width).attr("height",height).append("g").attr("transform","translate("+margin.left+","+margin.top+")").call(chart),n=t.append("g").attr("text-anchor","end").attr("transform","translate(-6,"+(height-margin.top-margin.bottom)/2+")");n.append("text").attr("class","title").text(function(e){return e.title}),n.append("text").attr("class","subtitle").attr("dy","1em").text(function(e){return e.subtitle}),chart.duration(1e3),window.transition=function(){t.datum(randomize).call(chart)}})