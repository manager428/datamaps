function pad(e){return e.length<6?(new Array(7-e.length)).join("0")+e:e}require("../../test/env");var fs=require("fs"),util=require("util"),Canvas=require("canvas"),w=1920,h=1080,projection=d3.geo.albersUsa().scale(2e3).translate([w/2,h/2]),path=d3.geo.path().projection(projection),canvas=new Canvas(w,h),context=canvas.getContext("2d");context.antialias="none",context.lineWidth=8,context.lineJoin="round",d3.json(__dirname+"/../data/us-counties.json",function(e){function n(t){e.features.forEach(function(e){function o(e){switch(r.charAt(i)){case"M":var t=r.substring(i+1,e).split(",").map(Number);context.moveTo(t[0],t[1]);break;case"L":var t=r.substring(i+1,e).split(",").map(Number);context.lineTo(t[0],t[1]);break;case"Z":context.closePath()}i=e}var n=/[MLZ]/g,r=path(e),i=0,s;context[t+"Style"]="#"+pad((+e.id).toString(16)),context.beginPath(),n.lastIndex=1;while(s=n.exec(r))o(s.index);o(),context[t]()})}n("stroke"),n("fill");var t=fs.createWriteStream("us-counties.png");canvas.createPNGStream().on("data",function(e){t.write(e)})})