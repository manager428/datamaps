function randomize(e){return e.randomizer||(e.randomizer=randomizer(e)),e.map(e.randomizer)}function randomizer(e){var t=d3.max(e)*.02;return function(e){return Math.max(min,Math.min(max,e+t*(Math.random()-.5)))}}function iqr(e){return function(t,n){var r=t.quartiles[0],i=t.quartiles[2],s=(i-r)*e,n=-1,o=t.length;while(t[++n]<r-s);while(t[--o]>i+s);return[n,o]}}function boxChart(){function a(a){a.each(function(a,f){a=a.map(i).sort(d3.ascending);var l=d3.select(this),c=a.length,h=a[0],p=a[c-1],d=a.quartiles=o(a),v=s&&s.call(this,a,f),m=v&&v.map(function(e){return a[e]}),g=v?d3.range(0,v[0]).concat(d3.range(v[1]+1,c)):d3.range(c),y=d3.scale.linear().domain(r&&r.call(this,a,f)||[h,p]).range([t,0]),b=this.__chart__||d3.scale.linear().domain([0,Infinity]).range(y.range());this.__chart__=y;var w=l.selectAll("line.center").data(m?[m]:[]);w.enter().insert("svg:line","rect").attr("class","center").attr("x1",e/2).attr("y1",function(e){return b(e[0])}).attr("x2",e/2).attr("y2",function(e){return b(e[1])}).style("opacity",1e-6).transition().duration(n).style("opacity",1).attr("y1",function(e){return y(e[0])}).attr("y2",function(e){return y(e[1])}),w.transition().duration(n).style("opacity",1).attr("y1",function(e){return y(e[0])}).attr("y2",function(e){return y(e[1])}),w.exit().transition().duration(n).style("opacity",1e-6).attr("y1",function(e){return y(e[0])}).attr("y2",function(e){return y(e[1])}).remove();var E=l.selectAll("rect.box").data([d]);E.enter().append("svg:rect").attr("class","box").attr("x",0).attr("y",function(e){return b(e[2])}).attr("width",e).attr("height",function(e){return b(e[0])-b(e[2])}).transition().duration(n).attr("y",function(e){return y(e[2])}).attr("height",function(e){return y(e[0])-y(e[2])}),E.transition().duration(n).attr("y",function(e){return y(e[2])}).attr("height",function(e){return y(e[0])-y(e[2])});var S=l.selectAll("line.median").data([d[1]]);S.enter().append("svg:line").attr("class","median").attr("x1",0).attr("y1",b).attr("x2",e).attr("y2",b).transition().duration(n).attr("y1",y).attr("y2",y),S.transition().duration(n).attr("y1",y).attr("y2",y);var x=l.selectAll("line.whisker").data(m||[]);x.enter().insert("svg:line","circle, text").attr("class","whisker").attr("x1",0).attr("y1",b).attr("x2",e).attr("y2",b).style("opacity",1e-6).transition().duration(n).attr("y1",y).attr("y2",y).style("opacity",1),x.transition().duration(n).attr("y1",y).attr("y2",y).style("opacity",1),x.exit().transition().duration(n).attr("y1",y).attr("y2",y).style("opacity",1e-6).remove();var T=l.selectAll("circle.outlier").data(g,Number);T.enter().insert("svg:circle","text").attr("class","outlier").attr("r",5).attr("cx",e/2).attr("cy",function(e){return b(a[e])}).style("opacity",1e-6).transition().duration(n).attr("cy",function(e){return y(a[e])}).style("opacity",1),T.transition().duration(n).attr("cy",function(e){return y(a[e])}).style("opacity",1),T.exit().transition().duration(n).attr("cy",function(e){return y(a[e])}).style("opacity",1e-6).remove();var N=u||y.tickFormat(8),C=l.selectAll("text.box").data(d);C.enter().append("svg:text").attr("class","box").attr("dy",".3em").attr("dx",function(e,t){return t&1?6:-6}).attr("x",function(t,n){return n&1?e:0}).attr("y",b).attr("text-anchor",function(e,t){return t&1?"start":"end"}).text(N).transition().duration(n).attr("y",y),C.transition().duration(n).text(N).attr("y",y);var k=l.selectAll("text.whisker").data(m||[]);k.enter().append("svg:text").attr("class","whisker").attr("dy",".3em").attr("dx",6).attr("x",e).attr("y",b).text(N).style("opacity",1e-6).transition().duration(n).attr("y",y).style("opacity",1),k.transition().duration(n).text(N).attr("y",y).style("opacity",1),k.exit().transition().duration(n).attr("y",y).style("opacity",1e-6).remove()}),d3.timer.flush()}var e=1,t=1,n=0,r=null,i=Number,s=boxWhiskers,o=boxQuartiles,u=null;return a.width=function(t){return arguments.length?(e=t,a):e},a.height=function(e){return arguments.length?(t=e,a):t},a.tickFormat=function(e){return arguments.length?(u=e,a):u},a.duration=function(e){return arguments.length?(n=e,a):n},a.domain=function(e){return arguments.length?(r=e==null?e:d3.functor(e),a):r},a.value=function(e){return arguments.length?(i=e,a):i},a.whiskers=function(e){return arguments.length?(s=e,a):s},a.quartiles=function(e){return arguments.length?(o=e,a):o},a}function boxWhiskers(e){return[0,e.length-1]}function boxQuartiles(e){return[d3.quantile(e,.25),d3.quantile(e,.5),d3.quantile(e,.75)]}var margin={top:10,right:50,bottom:20,left:50},width=120-margin.left-margin.right,height=500-margin.top-margin.bottom,min=Infinity,max=-Infinity,chart=boxChart().whiskers(iqr(1.5)).width(width).height(height);d3.csv("../data/morley.csv",function(e){var t=[];e.forEach(function(e){var n=~~e.Expt-1,r=~~e.Run-1,i=~~e.Speed,s=t[n];s?s.push(i):s=t[n]=[i],i>max&&(max=i),i<min&&(min=i)}),chart.domain([min,max]);var n=d3.select("#chart").selectAll("svg").data(t).enter().append("svg").attr("class","box").attr("width",width+margin.left+margin.right).attr("height",height+margin.bottom+margin.top).append("g").attr("transform","translate("+margin.left+","+margin.top+")").call(chart);chart.duration(1e3),window.transition=function(){n.datum(randomize).call(chart)}})