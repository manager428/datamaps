require("../env");var vows=require("vows"),assert=require("assert"),suite=vows.describe("selection.selectAll");suite.addBatch({"select(body)":{topic:function(){var e=d3.select("body").html("");return"__data__"in e[0][0]&&delete e[0][0].__data__,e.append("div").attr("class","first"),e.append("div").attr("class","second"),e},"selects all matching elements":function(e){var t=e.selectAll("div");assert.isTrue(t[0][0]===document.body.firstChild),assert.isTrue(t[0][1]===document.body.lastChild),assert.equal(t.length,1),assert.equal(t[0].length,2)},"propagates parent node to the selected elements":function(e){var t=e.selectAll("div");assert.isNotNull(t[0].parentNode),assert.isTrue(t[0].parentNode===document.body)},"does not propagate data if data was specified":function(e){var t=e.data([new Object]).selectAll("div");assert.isUndefined(t[0][0].__data__),assert.isUndefined(t[0][1].__data__)},"does not propagate data if data was not specified":function(e){var t=e.selectAll("div").data([1,2]);t=e.data([new Object]).selectAll("div"),assert.equal(t[0][0].__data__,1),assert.equal(t[0][1].__data__,2)},"returns empty array if no match is found":function(e){var t=e.selectAll("span");assert.equal(t.length,1),assert.equal(t[0].length,0)},"can select via function":function(e){var t={},n=[],r=[],i=[],s=e.data([t]).selectAll(function(e,t){return n.push(e),r.push(t),i.push(this),this.childNodes});assert.deepEqual(n,[t],"expected data, got {actual}"),assert.deepEqual(r,[0],"expected index, got {actual}"),assert.domEqual(i[0],document.body,"expected this, got {actual}"),assert.domEqual(s[0][0],document.body.firstChild),assert.domEqual(s[0][1],document.body.lastChild),delete document.body.__data__}}}),suite.addBatch({"selectAll(div)":{topic:function(){var e=d3.select("body").html("").selectAll("div").data(d3.range(2)).enter().append("div");return e.append("span").attr("class","first"),e.append("span").attr("class","second"),e},"selects all matching elements":function(e){var t=e.selectAll("span");assert.equal(t.length,2),assert.equal(t[0].length,2),assert.isTrue(t[0][0].parentNode===e[0][0]),assert.isTrue(t[0][1].parentNode===e[0][0]),assert.isTrue(t[1][0].parentNode===e[0][1]),assert.isTrue(t[1][1].parentNode===e[0][1])},"propagates parent node to the selected elements":function(e){var t=e.selectAll("span");assert.isNotNull(t[0].parentNode),assert.isTrue(t[0].parentNode===e[0][0]),assert.isTrue(t[1].parentNode===e[0][1])},"does not propagate data if data was specified":function(e){var t=e.selectAll("span");delete t[0][0].__data__,delete t[0][1].__data__,t=e.data([new Object,new Object]).selectAll("span"),assert.isUndefined(t[0][0].__data__),assert.isUndefined(t[0][1].__data__)},"does not propagate data if data was not specified":function(e){var t=new Object,n=new Object,r=e.selectAll("span").data([t,n]);delete e[0][0].__data__,delete e[0][1].__data__,r=e.selectAll("span"),assert.equal(r[0][0].__data__,t),assert.equal(r[0][1].__data__,n)},"returns empty array if no match is found":function(e){var e=e.selectAll("div");assert.equal(e.length,2),assert.equal(e[0].length,0),assert.equal(e[1].length,0)},"ignores null nodes":function(e){var t=d3.selectAll("div");t[0][1]=null;var n=t.selectAll("span");assert.equal(n.length,1),assert.equal(n[0].length,2),assert.isTrue(n[0][0].parentNode===e[0][0]),assert.isTrue(n[0][1].parentNode===e[0][0])},"can select via function":function(e){var t=[],n=[],r=[],i=e.data(["a","b"]).selectAll(function(e,i){return t.push(e),n.push(i),r.push(this),this.childNodes});assert.deepEqual(t,["a","b"],"expected data, got {actual}"),assert.deepEqual(n,[0,1],"expected index, got {actual}"),assert.domEqual(r[0],e[0][0],"expected this, got {actual}"),assert.domEqual(r[1],e[0][1],"expected this, got {actual}"),assert.domEqual(i[0][0],e[0][0].firstChild),assert.domEqual(i[0][1],e[0][0].lastChild),assert.domEqual(i[1][0],e[0][1].firstChild),assert.domEqual(i[1][1],e[0][1].lastChild)}}}),suite.export(module)