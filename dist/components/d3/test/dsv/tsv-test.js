require("../env");var vows=require("vows"),assert=require("assert"),suite=vows.describe("d3.tsv");suite.addBatch({tsv:{topic:function(){var e=this.callback;return d3.tsv("examples/data/sample.tsv",function(t){e(null,t)})},"invokes the callback with the parsed tsv":function(e){assert.deepEqual(e,[{Hello:42,World:'"fish"'}])},"overrides the mime type to text/tab-separated-values":function(e){assert.equal(XMLHttpRequest._last._info.mimeType,"text/tab-separated-values")},"":{topic:function(){var e=this.callback;return d3.tsv("//does/not/exist.tsv",function(t){e(null,t)})},"invokes the callback with null when an error occurs":function(e){assert.isNull(e)}}},parse:{topic:function(){return d3.tsv.parse},"returns an array of objects":function(e){assert.deepEqual(e("a	b	c\n1	2	3\n"),[{a:"1",b:"2",c:"3"}])},"does not strip whitespace":function(e){assert.deepEqual(e("a	b	c\n 1	 2	3\n"),[{a:" 1",b:" 2",c:"3"}])},"parses quoted values":function(e){assert.deepEqual(e('a	b	c\n"1"	2	3'),[{a:"1",b:"2",c:"3"}]),assert.deepEqual(e('a	b	c\n"1"	2	3\n'),[{a:"1",b:"2",c:"3"}])},"parses quoted values with quotes":function(e){assert.deepEqual(e('a\n"""hello"""'),[{a:'"hello"'}])},"parses quoted values with newlines":function(e){assert.deepEqual(e('a\n"new\nline"'),[{a:"new\nline"}]),assert.deepEqual(e('a\n"new\rline"'),[{a:"new\rline"}]),assert.deepEqual(e('a\n"new\r\nline"'),[{a:"new\r\nline"}])},"parses unix newlines":function(e){assert.deepEqual(e('a	b	c\n1	2	3\n4	5	"6"\n7	8	9'),[{a:"1",b:"2",c:"3"},{a:"4",b:"5",c:"6"},{a:"7",b:"8",c:"9"}])},"parses mac newlines":function(e){assert.deepEqual(e('a	b	c\r1	2	3\r4	5	"6"\r7	8	9'),[{a:"1",b:"2",c:"3"},{a:"4",b:"5",c:"6"},{a:"7",b:"8",c:"9"}])},"parses dos newlines":function(e){assert.deepEqual(e('a	b	c\r\n1	2	3\r\n4	5	"6"\r\n7	8	9'),[{a:"1",b:"2",c:"3"},{a:"4",b:"5",c:"6"},{a:"7",b:"8",c:"9"}])}},parseRows:{topic:function(){return d3.tsv.parseRows},"returns an array of arrays":function(e){assert.deepEqual(e("a	b	c\n"),[["a","b","c"]])},"parses quoted values":function(e){assert.deepEqual(e('"1"	2	3\n'),[["1","2","3"]]),assert.deepEqual(e('"hello"'),[["hello"]])},"parses quoted values with quotes":function(e){assert.deepEqual(e('"""hello"""'),[['"hello"']])},"parses quoted values with newlines":function(e){assert.deepEqual(e('"new\nline"'),[["new\nline"]]),assert.deepEqual(e('"new\rline"'),[["new\rline"]]),assert.deepEqual(e('"new\r\nline"'),[["new\r\nline"]])},"parses unix newlines":function(e){assert.deepEqual(e('a	b	c\n1	2	3\n4	5	"6"\n7	8	9'),[["a","b","c"],["1","2","3"],["4","5","6"],["7","8","9"]])},"parses mac newlines":function(e){assert.deepEqual(e('a	b	c\r1	2	3\r4	5	"6"\r7	8	9'),[["a","b","c"],["1","2","3"],["4","5","6"],["7","8","9"]])},"parses dos newlines":function(e){assert.deepEqual(e('a	b	c\r\n1	2	3\r\n4	5	"6"\r\n7	8	9'),[["a","b","c"],["1","2","3"],["4","5","6"],["7","8","9"]])}},format:{topic:function(){return d3.tsv.format},"takes an array of arrays as input":function(e){assert.equal(e([["a","b","c"],["1","2","3"]]),"a	b	c\n1	2	3")},"separates lines using unix newline":function(e){assert.equal(e([[],[]]),"\n")},"does not strip whitespace":function(e){assert.equal(e([["a "," b","c"],["1","2","3 "]]),"a 	 b	c\n1	2	3 ")},"does not quote simple values":function(e){assert.equal(e([["a"],[1]]),"a\n1")},"escapes double quotes":function(e){assert.equal(e([['"fish"']]),'"""fish"""')},"escapes unix newlines":function(e){assert.equal(e([["new\nline"]]),'"new\nline"')},"escapes tabs":function(e){assert.equal(e([["oxford	comma"]]),'"oxford	comma"')},"does not escape commas":function(e){assert.equal(e([["oxford,comma"]]),"oxford,comma")}}}),suite.export(module)