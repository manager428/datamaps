require("../env");var vows=require("vows"),assert=require("assert"),suite=vows.describe("d3.scale.log");suite.addBatch({log:{topic:function(){return d3.scale.log},domain:{"defaults to [1, 10]":function(e){var t=e();assert.deepEqual(t.domain(),[1,10]),assert.inDelta(t(5),.69897,1e-6)},"coerces domain values to numbers":function(e){var t=e().domain([new Date(1990,0,1),new Date(1991,0,1)]);assert.equal(typeof t.domain()[0],"number"),assert.equal(typeof t.domain()[1],"number"),assert.inDelta(t(new Date(1989,9,20)),-0.2,.01),assert.inDelta(t(new Date(1990,0,1)),0,.01),assert.inDelta(t(new Date(1990,2,15)),.2,.01),assert.inDelta(t(new Date(1990,4,27)),.4,.01),assert.inDelta(t(new Date(1991,0,1)),1,.01),assert.inDelta(t(new Date(1991,2,15)),1.2,.01);var t=e().domain(["1","10"]);assert.equal(typeof t.domain()[0],"number"),assert.equal(typeof t.domain()[1],"number"),assert.inDelta(t(5),.69897,1e-6);var t=e().domain([new Number(1),new Number(10)]);assert.equal(typeof t.domain()[0],"number"),assert.equal(typeof t.domain()[1],"number"),assert.inDelta(t(5),.69897,1e-6)},"can specify negative domain values":function(e){var t=e().domain([-100,-1]);assert.deepEqual(t.ticks().map(t.tickFormat()),["-1e+2","-9e+1","-8e+1","-7e+1","-6e+1","-5e+1","-4e+1","-3e+1","-2e+1","-1e+1","-9e+0","-8e+0","-7e+0","-6e+0","-5e+0","-4e+0","-3e+0","-2e+0","-1e+0"]),assert.inDelta(t(-50),.150515,1e-6)},"can specify a polylog domain and range":function(e){var t=e().domain([.1,1,100]).range(["red","white","green"]);assert.equal(t(.5),"#ffb2b2"),assert.equal(t(50),"#269326"),assert.equal(t(75),"#108810")}},range:{"defaults to [0, 1]":function(e){var t=e();assert.deepEqual(t.range(),[0,1]),assert.inDelta(t.invert(.5),3.162278,1e-6)},"does not coerce range to numbers":function(e){var t=e().range(["0","2"]);assert.equal(typeof t.range()[0],"string"),assert.equal(typeof t.range()[1],"string")},"can specify range values as colors":function(e){var t=e().range(["red","blue"]);assert.equal(t(5),"#4d00b2");var t=e().range(["#ff0000","#0000ff"]);assert.equal(t(5),"#4d00b2");var t=e().range(["#f00","#00f"]);assert.equal(t(5),"#4d00b2");var t=e().range([d3.rgb(255,0,0),d3.hsl(240,1,.5)]);assert.equal(t(5),"#4d00b2");var t=e().range(["hsl(0,100%,50%)","hsl(240,100%,50%)"]);assert.equal(t(5),"#4d00b2")},"can specify range values as arrays or objects":function(e){var t=e().range([{color:"red"},{color:"blue"}]);assert.deepEqual(t(5),{color:"#4d00b2"});var t=e().range([["red"],["blue"]]);assert.deepEqual(t(5),["#4d00b2"])}},interpolate:{"defaults to d3.interpolate":function(e){var t=e().range(["red","blue"]);assert.equal(t.interpolate(),d3.interpolate),assert.equal(t(5),"#4d00b2")},"can specify a custom interpolator":function(e){var t=e().range(["red","blue"]).interpolate(d3.interpolateHsl);assert.equal(t(5),"#9a00ff")}},clamp:{"defaults to false":function(e){var t=e();assert.isFalse(t.clamp()),assert.inDelta(t(.5),-0.3010299,1e-6),assert.inDelta(t(15),1.1760913,1e-6)},"can clamp to the domain":function(e){var t=e().clamp(!0);assert.inDelta(t(-1),0,1e-6),assert.inDelta(t(5),.69897,1e-6),assert.inDelta(t(15),1,1e-6);var t=e().domain([10,1]).clamp(!0);assert.inDelta(t(-1),1,1e-6),assert.inDelta(t(5),.30103,1e-6),assert.inDelta(t(15),0,1e-6)},"can clamp to the range":function(e){var t=e().clamp(!0);assert.inDelta(t.invert(-0.1),1,1e-6),assert.inDelta(t.invert(.69897),5,1e-6),assert.inDelta(t.invert(1.5),10,1e-6);var t=e().domain([10,1]).clamp(!0);assert.inDelta(t.invert(-0.1),10,1e-6),assert.inDelta(t.invert(.30103),5,1e-6),assert.inDelta(t.invert(1.5),1,1e-6)}},"maps a number to a number":function(e){var t=e().domain([1,2]);assert.inDelta(t(.5),-1,1e-6),assert.inDelta(t(1),0,1e-6),assert.inDelta(t(1.5),.5849625,1e-6),assert.inDelta(t(2),1,1e-6),assert.inDelta(t(2.5),1.3219281,1e-6)},invert:{"maps a number to a number":function(e){var t=e().domain([1,2]);assert.inDelta(t.invert(-1),.5,1e-6),assert.inDelta(t.invert(0),1,1e-6),assert.inDelta(t.invert(.5849625),1.5,1e-6),assert.inDelta(t.invert(1),2,1e-6),assert.inDelta(t.invert(1.3219281),2.5,1e-6)},"coerces range value to number on invert":function(e){var t=e().range(["0","2"]);assert.inDelta(t.invert("1"),3.1622777,1e-6);var t=e().range([new Date(1990,0,1),new Date(1991,0,1)]);assert.inDelta(t.invert(new Date(1990,6,2,13)),3.1622777,1e-6);var t=e().range(["#000","#fff"]);assert.isNaN(t.invert("#999"))}},ticks:{"can generate ticks":function(e){var t=e();assert.deepEqual(t.ticks().map(t.tickFormat()),["1e+0","2e+0","3e+0","4e+0","5e+0","6e+0","7e+0","8e+0","9e+0","1e+1"]);var t=e().domain([100,1]);assert.deepEqual(t.ticks().map(t.tickFormat()),["1e+0","2e+0","3e+0","4e+0","5e+0","6e+0","7e+0","8e+0","9e+0","1e+1","2e+1","3e+1","4e+1","5e+1","6e+1","7e+1","8e+1","9e+1","1e+2"]);var t=e().domain([.49999,.006029505943610648]);assert.deepEqual(t.ticks().map(t.tickFormat()),["7e-3","8e-3","9e-3","1e-2","2e-2","3e-2","4e-2","5e-2","6e-2","7e-2","8e-2","9e-2","1e-1","2e-1","3e-1","4e-1"]);var t=e().domain([.95,105e6]);assert.deepEqual(t.ticks().map(t.tickFormat(8)).filter(String),["1e+0","1e+1","1e+2","1e+3","1e+4","1e+5","1e+6","1e+7","1e+8"])},"can generate fewer ticks, if desired":function(e){var t=e();assert.deepEqual(t.ticks().map(t.tickFormat(5)),["1e+0","2e+0","3e+0","4e+0","5e+0","","","","","1e+1"]);var t=e().domain([100,1]);assert.deepEqual(t.ticks().map(t.tickFormat(10)),["1e+0","2e+0","3e+0","4e+0","5e+0","","","","","1e+1","2e+1","3e+1","4e+1","5e+1","","","","","1e+2"])},"generates powers-of-ten ticks, even for huge domains":function(e){var t=e().domain([1e10,1]);assert.deepEqual(t.ticks().map(t.tickFormat(10)),["1e+0","","","","","","","","","1e+1","","","","","","","","","1e+2","","","","","","","","","1e+3","","","","","","","","","1e+4","","","","","","","","","1e+5","","","","","","","","","1e+6","","","","","","","","","1e+7","","","","","","","","","1e+8","","","","","","","","","1e+9","","","","","","","","","1e+10"])},"can override the tick format":function(e){var t=e().domain([1000.1,1]);assert.deepEqual(t.ticks().map(t.tickFormat(10,d3.format("+,d"))),["+1","+2","+3","","","","","","","+10","+20","+30","","","","","","","+100","+200","+300","","","","","","","+1,000"])}},nice:{"can nice the domain, extending it to powers of ten":function(e){var t=e().domain([1.1,10.9]).nice();assert.deepEqual(t.domain(),[1,100]);var t=e().domain([10.9,1.1]).nice();assert.deepEqual(t.domain(),[100,1]);var t=e().domain([.7,11.001]).nice();assert.deepEqual(t.domain(),[.1,100]);var t=e().domain([123.1,6.7]).nice();assert.deepEqual(t.domain(),[1e3,1]);var t=e().domain([.01,.49]).nice();assert.deepEqual(t.domain(),[.01,1])},"works on degenerate domains":function(e){var t=e().domain([0,0]).nice();assert.deepEqual(t.domain(),[0,0]);var t=e().domain([.5,.5]).nice();assert.inDelta(t.domain(),[.1,1],1e-6)},"nicing a polylog domain only affects the extent":function(e){var t=e().domain([1.1,1.5,10.9]).nice();assert.deepEqual(t.domain(),[1,1.5,100]);var t=e().domain([-123.1,-1.5,-0.5]).nice();assert.deepEqual(t.domain(),[-1e3,-1.5,-0.1])}},copy:{"changes to the domain are isolated":function(e){var t=e(),n=t.copy();t.domain([10,100]),assert.deepEqual(n.domain(),[1,10]),assert.equal(t(10),0),assert.equal(n(1),0),n.domain([100,1e3]),assert.equal(t(100),1),assert.equal(n(100),0),assert.deepEqual(t.domain(),[10,100]),assert.deepEqual(n.domain().map(Math.round),[100,1e3])},"changes to the range are isolated":function(e){var t=e(),n=t.copy();t.range([1,2]),assert.equal(t.invert(1),1),assert.equal(n.invert(1),10),assert.deepEqual(n.range(),[0,1]),n.range([2,3]),assert.equal(t.invert(2),10),assert.equal(n.invert(2),1),assert.deepEqual(t.range(),[1,2]),assert.deepEqual(n.range(),[2,3])},"changes to the interpolator are isolated":function(e){var t=e().range(["red","blue"]),n=t.copy();t.interpolate(d3.interpolateHsl),assert.equal(t(5),"#9a00ff"),assert.equal(n(5),"#4d00b2"),assert.equal(n.interpolate(),d3.interpolate)},"changes to clamping are isolated":function(e){var t=e().clamp(!0),n=t.copy();t.clamp(!1),assert.inDelta(t(.5),-0.30103,1e-6),assert.equal(n(.5),0),assert.isTrue(n.clamp()),n.clamp(!1),assert.inDelta(t(20),1.30103,1e-6),assert.inDelta(n(20),1.30103,1e-6),assert.isFalse(t.clamp())}}}}),suite.export(module)